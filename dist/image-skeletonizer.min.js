var ImageSkeletonizer=function(){"use strict";var t=function(t,i){this.tolerance=void 0!==i?i:12,this.width=t.width,this.height=t.height,this.data=new Uint8Array(t.width*t.height),this._buildBinaryImage(t,this.tolerance)};t.prototype.constructor=t,t.prototype.getIndex=function(t,i){return i*this.width+t},t.prototype.getValue=function(t,i){return this.data[this.getIndex(t,i)]},t.prototype._buildBinaryImage=function(t,i){for(var e=this.width*this.height,h=0;h<e;h++){var o=4*h;t.data[o]<125&&t.data[o+1]<125&&t.data[o+2]<125?this.data[h]=1:this.data[h]=0}};var i=t,e=i,h=function(t,i,h,o){if(!(h instanceof e))throw"IntDistanceImage Error : source must be an instance of BinaryImage";this.coeff=t,this.width=h.width,this.height=h.height,this.data=new Array(h.width*h.height),this._buildDistanceImage(t,i,h,o)};h.prototype.constructor=h,h.prototype.rebuild=function(t,i,e,h){this.coeff=t,this._buildDistanceImage(t,i,e,h,this.data)},h.prototype.getCoeff=function(){return this.coeff},h.prototype.getIndex=function(t,i){return i*this.width+t},h.prototype.getValue=function(t,i){return this.data[this.getIndex(t,i)]},h.prototype.getIndexValue=function(t){return this.data[t]},h.prototype.getXFromIndex=function(t){return t%this.width},h.prototype.getYFromIndex=function(t){return Math.floor(t/this.width)},h.prototype._buildDistanceImage=function(t,i,e,h){const o=e.width,n=e.height;for(let t=0;t<o;++t)this.data[t]=0;for(let s=1;s<n-1;++s){this.data[s*o]=0;for(let n=1;n<o-1;++n){let o=this.getIndex(n,s);this.data[o]=0;let r=0;if(e.data[o]!=h){let e=this.getIndex(n-1,s-1),h=this.getIndex(n,s-1),a=this.getIndex(n-1,s),g=this.getIndex(n+1,s-1);r=Math.min(this.data[e]+i,this.data[h]+t),r=Math.min(r,this.data[a]+t),r=Math.min(r,this.data[g]+i),this.data[o]=r}}this.data[this.getIndex(o-1,s)]=0}for(let t=0;t<o;++t)this.data[this.getIndex(t,n-1)]=0;for(let s=n-2;s>0;--s)for(let n=o-2;n>0;--n){let o=this.getIndex(n,s),r=this.data[o];if(e.data[o]!=h){let e=this.getIndex(n+1,s+1),h=this.getIndex(n,s+1),a=this.getIndex(n-1,s+1),g=this.getIndex(n+1,s);r=Math.min(r,this.data[e]+i),r=Math.min(r,this.data[h]+t),r=Math.min(r,this.data[a]+i),this.data[o]=Math.min(r,this.data[g]+t)}}},h.prototype.getImageData=function(t){var i=new ImageData(this.width,this.height);let e=0;for(let t=0;t<this.width*this.height;t++)e=this.data[t]>e?this.data[t]:e;for(let t=0,h=0,o=0;t<this.height;t++)for(let n=0;n<this.width;n++){let s=t*this.width+n;this.data[s]>3?(o=255*this.data[s]/e,i.data[h]=o,i.data[h+1]=o,i.data[h+2]=o,i.data[h+3]=255):(i.data[h]=255,i.data[h+1]=255,i.data[h+2]=255,i.data[h+3]=255),h+=4}return i};var o=h,n=function(t,i){this.x=t,this.y=i};n.prototype.distanceToOrigin=function(t){var i=this.x,e=this.y;return Math.sqrt(i*i+e*e)},n.prototype.distanceTo=function(t){var i=this.x-t.x,e=this.y-t.y;return Math.sqrt(i*i+e*e)},n.prototype.barycenter=function(t,i,e,h){var o=h/(e+h);return this.x=(1-o)*t.x+o*i.x,this.y=(1-o)*t.y+o*i.y,this};var s=n,r=function(t,i,e,h){this.width=t.width,this.height=t.height,this.data=new Array(this.width*this.height);for(let e=0;e<this.width*this.height;e++)t.data[e]!=i?this.data[e]=1:this.data[e]=0;let o=0;for(let t=0;t<h.width*h.height;t++)o=h.data[t]>o?h.data[t]:o;this.CleanBorderPixels(),this.skeletonizeEckhardtMaderlechner93(e,h,.8*o),this.CleanBorderPixels(),this.thin()};r.prototype.constructor=r,r.prototype.getIndex=function(t,i){return i*this.width+t},r.prototype.getXFromIndex=function(t){return t%this.width},r.prototype.getYFromIndex=function(t){return Math.floor(t/this.width)},r.prototype.getImageData=function(t,i){var e=new ImageData(this.width,this.height),h=t||[255,255,255,255],o=i||[255,0,0,255];let n=0;for(let t=0;t<this.width*this.height;t++)n=this.data[t]>n?this.data[t]:n;for(let t=0,i=0;t<this.height;t++)for(let n=0;n<this.width;n++){let s=t*this.width+n;1===this.data[s]?(e.data[i]=o[0],e.data[i+1]=o[1],e.data[i+2]=o[2],e.data[i+3]=o[3]):(e.data[i]=h[0],e.data[i+1]=h[1],e.data[i+2]=h[2],e.data[i+3]=h[3]),i+=4}return e},r.prototype.CleanBorderPixels=function(){for(let t=0;t<this.width;t++)this.data[t]=0,this.data[(this.height-1)*this.width+t]=0;for(let t=1;t<this.height-2;t++)this.data[t*this.width]=0,this.data[t*this.width+(this.width-1)]=0},r.prototype.thin=function(){let t=this.width-2;for(let i=1;i<this.height-1;i++){t+=2;for(let i=1;i<this.width-1;i++){if(t++,0==(1&this.data[t]))continue;const i=this.getCurrentNeighborhood(t);(0==(7&i)&&112==(112&i)||0==(14&i)&&160==(160&i)||0==(28&i)&&193==(193&i)||0==(56&i)&&130==(130&i)||0==(112&i)&&7==(7&i)||0==(224&i)&&10==(10&i)||0==(193&i)&&28==(28&i)||0==(131&i)&&40==(40&i))&&(this.data[t]=0)}}return this.data},r.prototype.skeletonizeEckhardtMaderlechner93=function(t,i,e){const h=this.width*this.height,o=new Array(this.width*this.height),n=new Array(this.width*this.height),s=new Array(this.width*this.height),r=new Array(this.width*this.height),a=new Array(this.width*this.height),g=new Array(this.width*this.height),d=new Array(this.width*this.height),f=new Array(this.width*this.height);let y=!0,u=0;const c=this.width+1,l=h-this.width-1;for(;y&&u<t;){y=!1;for(let t=c;t<l;t++)n[t]=this.getNbStrongNeighbors(this.data,t),s[t]=n[t]+this.getNbNoStrongNeighbors(this.data,t),this.data[t]?4==n[t]?(o[t]=2,f[t]=1):(o[t]=1,f[t]=2):o[t]=0;for(let t=c;t<l;t++)this.data[t]?r[t]=1==o[t]&&(2==o[t+1]||2==o[t-1]||2==o[t+this.width]||2==o[t-this.width]):r[t]=!1,r[t]?(r[t]=1,f[t]=3):r[t]=0;for(let t=c;t<l;++t){if(this.data[t]&&1==o[t]){let i=0!=(1&this.data[t+1]),e=0!=(1&this.data[t-this.width+1]),h=0!=(1&this.data[t-this.width]),n=0!=(1&this.data[t-this.width-1]),s=0!=(1&this.data[t-1]),r=0!=(1&this.data[t+this.width-1]),a=0!=(1&this.data[t+this.width]),d=0!=(1&this.data[t+this.width+1]);const f=(1-i)*e+(1-e)*h+(1-h)*n+(1-n)*s+(1-s)*r+(1-r)*a+(1-a)*d+(1-d)*i,y=i+e+h+n+s+r+a+d,u=1==f||0==f&&8==y;g[t]=1==o[t]&&u&&(i||h||s||a)}else g[t]=!1;g[t]&&(f[t]=4)}for(let t=c;t<l;++t){if(this.data[t]){const i=2==o[t+1]&&!this.data[t-1],e=2==o[t-1]&&!this.data[t+1],h=2==o[t+this.width]&&!this.data[t-this.width],n=2==o[t-this.width]&&!this.data[t+this.width];a[t]=r[t]&&(i||e||h||n)}else a[t]=!1;a[t]&&(f[t]=5)}for(let t=0;t<h;++t)this.data[t]?g[t]&&a[t]?(d[t]=0,f[t]=6,y=!0):0==s[t]?d[t]=0:i.data[t]<e&&1==s[t]?(d[t]=0,y=!0):d[t]=1:(d[t]=0,f[t]=0);for(let t=0;t<d.length;t++)this.data[t]=d[t];++u}},r.prototype.getCurrentNeighborhood=function(t){var i=this.data;return(1&i[t-1])<<7|(1&i[t+1])<<3|(1&i[t+this.width])<<5|(1&i[t-this.width])<<1|1&i[t-(this.width+1)]|(1&i[t-(this.width-1)])<<2|(1&i[t+(this.width-1)])<<6|(1&i[t+(this.width+1)])<<4},r.prototype.nbNeighbours=function(t){return(1&t)+(t>>1&1)+(t>>2&1)+(t>>3&1)+(t>>4&1)+(t>>5&1)+(t>>6&1)+(t>>7&1)},r.prototype.getNbStrongNeighbors=function(t,i){return t[i-1]+t[i+1]+t[i-this.width]+t[i+this.width]},r.prototype.getNbNoStrongNeighbors=function(t,i){return t[i-1-this.width]+t[i-1+this.width]+t[i+1-this.width]+t[i+1+this.width]},r.prototype.isInnerBoundaryPixel=function(t,i){return 1==t[i]&&2==t[i-1]||2==t[i+1]||2==t[i-this.width]||2==t[i+this.width]},r.prototype.isSimpleBoundaryPixel=function(t,i){let e=0!=(1&t[i+1]),h=0!=(1&t[i-this.width+1]),o=0!=(1&t[i-this.width]),n=0!=(1&t[i-this.width-1]),s=0!=(1&t[i-1]),r=0!=(1&t[i+this.width-1]),a=0!=(1&t[i+this.width]),g=0!=(1&t[i+this.width+1]);const d=(1-e)*h+(1-h)*o+(1-o)*n+(1-n)*s+(1-s)*r+(1-r)*a+(1-a)*g+(1-g)*e;return(1==d||0==d&&8==e+h+o+n+s+r+a+g)&&(e||o||s||a)};var a=r,g=function(t,i){this.position=t,this.weight=i,this.neighbors=new Map};g.computeKey=function(t,i){return Math.floor(t)+";"+Math.floor(i)},g.getXYFromKey=function(t){var i=t.split(";");return i[0]=parseInt(i[0]),i[1]=parseInt(i[1]),i},g.prototype.constructor=g,g.prototype.getKey=function(){return g.computeKey(this.position.x,this.position.y)},g.prototype.getPosition=function(){return this.position},g.prototype.getWeight=function(){return this.weight},g.prototype.getNeighbors=function(){return this.neighbors},g.prototype.setPosition=function(t){this.position=t},g.prototype.setWeight=function(t){this.weight=t},g.prototype.setNeighbors=function(t){this.neighbors=t},g.prototype.addNeighbor=function(t){this.neighbors.set(t.getKey(),t),t.neighbors.set(this.getKey(),this)},g.prototype.removeNeighbor=function(t){this.neighbors.delete(t.getKey()),t.neighbors.delete(this.getKey())},g.prototype.hasNeighbor=function(t){return this.neighbors.has(t.getKey())};var d=g,f=function(t,i){this.x=t||0,this.y=i||0};f.prototype.length=function(t){var i=this.x,e=this.y;return Math.sqrt(i*i+e*e)},f.prototype.subPoints=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},f.prototype.angle=function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t};var y=f;const u=d,c=s,l=y;var p=function(t,i){this.skelImg=t,this.distImg=i};p.prototype.constructor=p,p.prototype.buildHierarchy=function(t){(t=t||{}).angle=t.angle||Math.PI/13,t.weightFactor=t.weightFactor||1.25;const i=this.skelImg.width*this.skelImg.height;let e={},h=[],o=this._findNextPixelWithNeighbors(0);for(;o<i;){const t=this.skelImg.getXFromIndex(o),i=this.skelImg.getYFromIndex(o);var n=u.computeKey(t+.5,i+.5);void 0===e[n]&&(e[n]=new u(new c(t+.5,i+.5),this.distImg.data[o]/this.distImg.getCoeff()),h.push(e[n]),this._recHierarchy(e[n],e)),o=this._findNextPixelWithNeighbors(o+1)}return this._simplifyHierarchy(h,t.angle,t.weightFactor)},p.prototype._simplifyHierarchy=function(t,i,e){if(e<1)throw"weight_factor must be greater than 1 as it compares weight_max and weight_factor*weight_min";for(var h=function(t,o){for(var n=new l,s=o,a=new l,g=s.getNeighbors().size,d=!0,f=!0,y=null,u=0;2===g&&d&&f&&!r[s.getKey()];){var c=s.getNeighbors().keys();y=s,(s=s.getNeighbors().get(c.next().value))===t&&(s=y.getNeighbors().get(c.next().value));u<3&&(a.x+=s.getPosition().x,a.y+=s.getPosition().y),2===u&&(a.x=(a.x-3*t.getPosition().x)/3,a.y=(a.y-3*t.getPosition().y)/3),u++,n.subPoints(s.getPosition(),t.getPosition());var p=n.angle()-a.angle();if(Math.abs(p)<i||u<3||(d=!1),u>=3){var w=t.getWeight()/s.getWeight();w<1&&(w=1/w),w>e&&(f=!1)}d&&f&&(t.removeNeighbor(y),s.removeNeighbor(y),t.addNeighbor(s)),r[y.getKey()]=!0,g=s.getNeighbors().size}if(!r[s.getKey()])if(1===g)d&&f||y&&y.removeNeighbor(s),0===u&&t.removeNeighbor(s),r[s.getKey()]=!0;else if(2===g)h(y,s),r[y.getKey()]=!0;else{var x=[];s.getNeighbors().forEach((function(i,e,h){i!==y&&i!==t&&x.push(i)})),y&&(t.removeNeighbor(y),s.removeNeighbor(y),t.addNeighbor(s)),r[s.getKey()]=!0;for(var I=new Map,m=0;m<x.length;++m){for(var v=m+1;v<x.length;++v)x[m].removeNeighbor(x[v]);x[m].getNeighbors().forEach((function(t,i,e){I.set(i,t)}))}I.delete(s.getKey());var b=new l;I.forEach((function(t,i,e){for(var h=0,o=0;o<x.length;++o)t.hasNeighbor(x[o])&&h++;if(h>1)for(o=0;o<x.length;++o)t.hasNeighbor(x[o])&&(b.subPoints(t.getPosition(),x[o].getPosition()),b.length()>1&&t.removeNeighbor(x[o]))}));for(m=0;m<x.length;++m)h(s,x[m])}},o=0;o<t.length;++o){var n=t[o],s=null;n.getNeighbors().size>1&&(s=new u(new c(n.getPosition().x,n.getPosition().y-1),n.getWeight()),n.addNeighbor(s),t[o]=s,n=s);var r={};r[n.getKey()]=!0,n.getNeighbors().get(n.getNeighbors().keys().next().value),h(n,n.getNeighbors().get(n.getNeighbors().keys().next().value))}return t},p.prototype._findNextPixelWithNeighbors=function(t){const i=this.skelImg.width*this.skelImg.height;let e=t;for(e=t;e<i;e++)if(1&this.skelImg.data[e]){if(0!=this.skelImg.getCurrentNeighborhood(e))break;this.skelImg.data[e]=0}return e},p.prototype._checkAndCreate=function(t,i,e,h){var o=u.computeKey(t+.5,i+.5),n=!1;return void 0===h[o]&&(h[o]=new u(new c(t+.5,i+.5),this.distImg.getValue(t,i)/this.distImg.getCoeff()),n=!0),e.neighbors.set(o,h[o]),n},p.prototype._addNeighbors=function(t,i,e){this.skelImg.width;const h=Math.floor(t.position.x),o=Math.floor(t.position.y);let n=0;return 1&i&&(n+=this._checkAndCreate(h-1,o-1,t,e)?1:0),2&i&&(n+=this._checkAndCreate(h,o-1,t,e)?1:0),4&i&&(n+=this._checkAndCreate(h+1,o-1,t,e)?1:0),8&i&&(n+=this._checkAndCreate(h+1,o,t,e)?1:0),16&i&&(n+=this._checkAndCreate(h+1,o+1,t,e)?1:0),32&i&&(n+=this._checkAndCreate(h,o+1,t,e)?1:0),64&i&&(n+=this._checkAndCreate(h-1,o+1,t,e)?1:0),128&i&&(n+=this._checkAndCreate(h-1,o,t,e)?1:0),n},p.prototype._addNeighborsOLD=function(t,i,e,h){const o=this.skelImg.width,n=e%o,s=Math.round(e/o);let r=0;if(1&i){if(void 0===h[e-o-1]){const t=new u(new c(n-1+.5,s-1+.5),this.distImg.getIndexValue(e-o-1));h[e-o-1]=t,r++}t.neighbors.set(e-o-1,h[e-o-1])}if(2&i){if(void 0===h[e-o]){const t=new u(new c(n+.5,s-1+.5),this.distImg.getIndexValue(e-o));h[e-o]=t,r++}t.neighbors.set(e-o,h[e-o])}if(4&i){if(void 0===h[e-o+1]){const t=new u(new c(n+1+.5,s-1+.5),this.distImg.getIndexValue(e-o+1));h[e-o+1]=t,r++}t.neighbors.set(e-o+1,h[e-o+1])}if(8&i){if(void 0===h[e+1]){const t=new u(new c(n+1+.5,s+.5),this.distImg.getIndexValue(e+1));h[e+1]=t,r++}t.neighbors.set(e+1,h[e+1])}if(16&i){if(void 0===h[e+o+1]){const t=new u(new c(n+1+.5,s+1+.5),this.distImg.getIndexValue(e+o+1));h[e+o+1]=t,r++}t.neighbors.set(e+o+1,h[e+o+1])}if(32&i){if(void 0===h[e+o]){const t=new u(new c(n+.5,s+1+.5),this.distImg.getIndexValue(e+o));h[e+o]=t,r++}t.neighbors.set(e+o,h[e+o])}if(64&i){if(void 0===h[e+o-1]){const t=new u(new c(n-1+.5,s+1+.5),this.distImg.getIndexValue(e+o-1));h[e+o-1]=t,r++}t.neighbors.set(e+o-1,h[e+o-1])}if(128&i){if(void 0===h[e-1]){const t=new u(new c(n-1+.5,s+.5),this.distImg.getIndexValue(e-1));h[e-1]=t,r++}t.neighbors.set(e-1,h[e-1])}return r},p.prototype._recHierarchy=function(t,i){const e=this.skelImg.getCurrentNeighborhood(this.skelImg.getIndex(Math.floor(t.position.x),Math.floor(t.position.y)));if(this._addNeighbors(t,e,i))for(let[e,h]of t.getNeighbors())this._recHierarchy(h,i)};var w=p;const x=y,I=s;var m,v,b,N=(m=new x,v=new x,b=new I,function(t,i,e,h,o){m.x=i.x-t.x,m.y=i.y-t.y;var n=m.length();m.x=m.x/n,m.y=m.y/n,v.subPoints(o,t);var s=v.length(),r=s*s,a=v.x*m.x+v.y*m.y,g=(a+-Math.sqrt(Math.max(0,r-a*a))/n*(e-h))/n;return g>1&&(g=1),g<0&&(g=0),b.x=t.x,b.y=t.y,b.x+=(i.x-b.x)*g,b.y+=(i.y-b.y)*g,b.z+=(i.z-b.z)*g,v.x=o.x-b.x,v.y=o.y-b.y,v.length()-(g*h+(1-g)*e)});const M=d,k=s,P=N;var _=function(t){this.distImg=t};_.prototype.constructor=_,_.prototype.buildHierarchy=function(){var t=this;const i=this.distImg.width,e=this.distImg.height;for(var h={},o={},n=[],s=new Array(i*e),r=0;r<s.length;++r)s[r]=!1;for(var a=function(e,h,o){for(var n=e.position.x,r=e.position.y,a=e.getPosition(),g=Math.ceil(e.weight),d=h?Math.ceil(h.getWeight()):0,f=h?h.getPosition():null,y=new k(0,0),u={min:{x:h?Math.min(a.x-g,f.x-d):a.x-g,y:h?Math.min(a.y-g,f.y-d):a.y-g},max:{x:h?Math.max(a.x+g,f.x+d):a.x+g,y:h?Math.max(a.y+g,f.y+d):a.y+g}},c=u.min.x;c<u.max.x;c++)for(var l=u.min.y;l<u.max.y;l++){y.x=c,y.y=l;var p=h?P(e.getPosition(),h.getPosition(),g,Math.ceil(h.weight),y):(c-n)*(c-n)+(l-r)*(l-r);if(h?p<=0:p<=g*g)s[v=l*i+c]=!0,delete o[v]}for(var w=2*Math.PI*(e.weight+1),x=Math.round(w),I=0;I<x;++I){var m=2*I*Math.PI/x,v=(c=Math.round(e.position.x+Math.cos(m)*(e.weight+1)),(l=Math.round(e.position.y+Math.sin(m)*(e.weight+1)))*i+c),b=t.distImg.getValue(c,l)/t.distImg.getCoeff();!s[v]&&b>3&&(o[v]=e)}},g=0,d=-1,f=-1,y=0;y<i;++y)for(var u=0;u<e;++u){var c=this.distImg.getValue(y,u);c>g&&(g=c,d=y,f=u)}var l=new M(new k(d,f),g/this.distImg.getCoeff());o[this.distImg.getIndex(d,f)]=l,n.push(l),a(l,null,h);for(var p=0,w=Object.keys(h);0!==w.length&&p<1e4;){var x=-1,I=0;for(r=0;r<w.length;++r){var m=parseInt(w[r]);s[m]?delete h[w[r]]:this.distImg.getIndexValue(m)>I&&(I=this.distImg.getIndexValue(m),x=m)}I/=this.distImg.getCoeff();var v=new k(this.distImg.getXFromIndex(x),this.distImg.getYFromIndex(x)),b=h[x],N={v:I,p:new k(v.x,v.y),idx:x};(function(){var i=b.getPosition().distanceTo(v),e=new k(0,0);e.barycenter(v,b.getPosition(),.5,.5),e.x=Math.round(e.x),e.y=Math.round(e.y);var h=t.distImg.getValue(e.x,e.y)/t.distImg.getCoeff(),o=new k(0,0),n=new k(v.x-b.getPosition().x,v.y-b.getPosition().y);n.x/=i,n.y/=i;for(var s=new k(-n.y,n.x),r={v:h,p:new k(e.x,e.y),idx:x},a=Math.max(b.getWeight()/2,3),g=-a;g<=a;g++){o.x=Math.round(e.x+g*s.x),o.y=Math.round(e.y+g*s.y);var d=t.distImg.getValue(o.x,o.y)/t.distImg.getCoeff();d>r.v&&d>h+1.5&&(r.v=d,r.p.x=o.x,r.p.y=o.y)}return(r.p.x!==e.x||r.p.y!==e.y)&&(N.v=r.v,N.p.x=r.p.x,N.p.y=r.p.y,N.idx=t.distImg.getIndex(r.p.x,r.p.y),!0)})()||function(){for(var i=b.getPosition().distanceTo(v),e=new k(0,0),h=1;h<i;h+=1){var o=h/i;e.barycenter(v,b.getPosition(),1-o,o),e.x=Math.round(e.x),e.y=Math.round(e.y);var n=t.distImg.getValue(e.x,e.y)/t.distImg.getCoeff(),s=h+I-n,r=(1-o)*I+o*b.weight;s<1&&n>r&&(N.v=n,N.p.x=e.x,N.p.y=e.y,N.idx=t.distImg.getIndex(e.x,e.y))}}();var _=new M(N.p,N.v);_.neighbors.set(this.distImg.getIndex(b.position.x,b.position.y),b),b.neighbors.set(this.distImg.getIndex(_.position.x,_.position.y),_),o[N.idx]=_,n.push(_),delete h[x],delete h[N.idx],a(_,b,h),w=Object.keys(h),p++}return n};const C=i,A=o,K=s,V=a,W=w,F=_,z=N;var D={};return D.BinaryImage=C,D.IntDistanceImage=A,D.SkeletonImage=V,D.Skeletonizer=W,D.skeletonize=function(t,i,e){var h=new C(t),o=new A(3,4,h,0),n=new V(h,0,2e3,o);return{skeleton:new W(n,o).buildHierarchy({angle:i||void 0,weightFactor:e||void 0}),binaryImg:h,distImg:o,skelImg:n}},D.skeletonizeQ=function(t){var i=new C(t),e=new A(3,4,i,0);return{skeleton:new F(e).buildHierarchy(),binaryImg:i,distImg:e}},D.drawHierarchyInImageData=function(t,i,e){for(var h=i,o="capsule"===e,n=new K,s={},r=[],a=[],g=function(t){var i=t.getKey();void 0===s[i]&&(s[i]=t,r.push(t),t.getNeighbors().forEach((function(i,e,h){var o=i.getKey();void 0===s[o]&&a.push([t,i]),g(i)})))},d=0;d<t.length;++d)g(t[d]);for(var f=0;f<h.width;++f)for(var y=0;y<h.height;++y){var u=0;if(n.x=f+.5,n.y=y+.5,o)for(d=0;d<a.length;++d){var c=a[d][0],l=a[d][1];z(c.getPosition(),l.getPosition(),c.getWeight(),l.getWeight(),n)<=0&&u++}else for(d=0;d<r.length;++d){var p=Math.floor(r[d].getPosition().x)+.5,w=Math.floor(r[d].getPosition().y)+.5;(n.x-p)*(n.x-p)+(n.y-w)*(n.y-w)<=r[d].getWeight()*r[d].getWeight()&&u++}var x=4*(y*h.width+f);h.data[x+1]=(h.data[x+1]+255*u)/(u+1)}for(d=0;d<r.length;++d){var I=r[d];x=4*(Math.floor(I.position.y)*h.width+Math.floor(I.position.x));h.data[x]=255,h.data[x+1]=0,h.data[x+2]=0}return h},D.drawSkeletonInCanvas=function(t,i){for(var e=i.getContext("2d"),h={},o=[],n=function(t){var i=t.position.x+";"+t.position.y;void 0===h[i]&&(h[i]=t,o.push(t),t.getNeighbors().forEach((function(t,i,e){n(t)})))},s=0;s<t.length;++s)n(t[s]);for(s=0;s<o.length;++s){var r=o[s];r.getNeighbors().forEach((function(t,i,h){e.lineWidth=1,e.strokeStyle="#ff0000",e.beginPath(),e.moveTo(r.position.x,r.position.y),e.lineTo(t.position.x,t.position.y),e.stroke(),e.fillStyle="#0000ff",e.fillRect(r.position.x,r.position.y,1,1),e.fillRect(t.position.x,t.position.y,1,1)}))}},D}();
