var ImageSkeletonizer=function(t){"use strict";var i=function(t,i){this.tolerance=void 0!==i?i:12,this.width=t.width,this.height=t.height,this.data=new Uint8Array(t.width*t.height),this._buildBinaryImage(t,this.tolerance)};i.prototype.constructor=i,i.prototype.getIndex=function(t,i){return i*this.width+t},i.prototype.getValue=function(t,i){return this.data[this.getIndex(t,i)]},i.prototype._buildBinaryImage=function(t,i){for(var e=this.width*this.height,h=0;h<e;h++){var o=4*h;t.data[o]<125&&t.data[o+1]<125&&t.data[o+2]<125?this.data[h]=1:this.data[h]=0}};var e=i,h=e,o=function(t,i,e,o){if(!(e instanceof h))throw"IntDistanceImage Error : source must be an instance of BinaryImage";this.coeff=t,this.width=e.width,this.height=e.height,this.data=new Array(e.width*e.height),this._buildDistanceImage(t,i,e,o)};o.prototype.constructor=o,o.prototype.rebuild=function(t,i,e,h){this.coeff=t,this._buildDistanceImage(t,i,e,h,this.data)},o.prototype.getCoeff=function(){return this.coeff},o.prototype.getIndex=function(t,i){return i*this.width+t},o.prototype.getValue=function(t,i){return this.data[this.getIndex(t,i)]},o.prototype.getIndexValue=function(t){return this.data[t]},o.prototype.getXFromIndex=function(t){return t%this.width},o.prototype.getYFromIndex=function(t){return Math.floor(t/this.width)},o.prototype._buildDistanceImage=function(t,i,e,h){const o=e.width,n=e.height;for(let t=0;t<o;++t)this.data[t]=0;for(let s=1;s<n-1;++s){this.data[s*o]=0;for(let n=1;n<o-1;++n){let o=this.getIndex(n,s);this.data[o]=0;let r=0;if(e.data[o]!=h){let e=this.getIndex(n-1,s-1),h=this.getIndex(n,s-1),a=this.getIndex(n-1,s),g=this.getIndex(n+1,s-1);r=Math.min(this.data[e]+i,this.data[h]+t),r=Math.min(r,this.data[a]+t),r=Math.min(r,this.data[g]+i),this.data[o]=r}}this.data[this.getIndex(o-1,s)]=0}for(let t=0;t<o;++t)this.data[this.getIndex(t,n-1)]=0;for(let s=n-2;s>0;--s)for(let n=o-2;n>0;--n){let o=this.getIndex(n,s),r=this.data[o];if(e.data[o]!=h){let e=this.getIndex(n+1,s+1),h=this.getIndex(n,s+1),a=this.getIndex(n-1,s+1),g=this.getIndex(n+1,s);r=Math.min(r,this.data[e]+i),r=Math.min(r,this.data[h]+t),r=Math.min(r,this.data[a]+i),this.data[o]=Math.min(r,this.data[g]+t)}}},o.prototype.getImageData=function(t){var i=new ImageData(this.width,this.height);let e=0;for(let t=0;t<this.width*this.height;t++)e=this.data[t]>e?this.data[t]:e;for(let t=0,h=0,o=0;t<this.height;t++)for(let n=0;n<this.width;n++){let s=t*this.width+n;this.data[s]>3?(o=255*this.data[s]/e,i.data[h]=o,i.data[h+1]=o,i.data[h+2]=o,i.data[h+3]=255):(i.data[h]=255,i.data[h+1]=255,i.data[h+2]=255,i.data[h+3]=255),h+=4}return i};var n=o,s=function(t,i){this.x=t,this.y=i};s.prototype.distanceToOrigin=function(t){var i=this.x,e=this.y;return Math.sqrt(i*i+e*e)},s.prototype.distanceTo=function(t){var i=this.x-t.x,e=this.y-t.y;return Math.sqrt(i*i+e*e)},s.prototype.barycenter=function(t,i,e,h){var o=h/(e+h);return this.x=(1-o)*t.x+o*i.x,this.y=(1-o)*t.y+o*i.y,this};var r=s,a=function(t,i,e,h){this.width=t.width,this.height=t.height,this.data=new Array(this.width*this.height);for(let e=0;e<this.width*this.height;e++)t.data[e]!=i?this.data[e]=1:this.data[e]=0;let o=0;for(let t=0;t<h.width*h.height;t++)o=h.data[t]>o?h.data[t]:o;this.CleanBorderPixels(),this.skeletonizeEckhardtMaderlechner93(e,h,.8*o),this.CleanBorderPixels(),this.thin()};a.prototype.constructor=a,a.prototype.getIndex=function(t,i){return i*this.width+t},a.prototype.getXFromIndex=function(t){return t%this.width},a.prototype.getYFromIndex=function(t){return Math.floor(t/this.width)},a.prototype.getImageData=function(t,i){var e=new ImageData(this.width,this.height),h=t||[255,255,255,255],o=i||[255,0,0,255];let n=0;for(let t=0;t<this.width*this.height;t++)n=this.data[t]>n?this.data[t]:n;for(let t=0,i=0;t<this.height;t++)for(let n=0;n<this.width;n++){let s=t*this.width+n;1===this.data[s]?(e.data[i]=o[0],e.data[i+1]=o[1],e.data[i+2]=o[2],e.data[i+3]=o[3]):(e.data[i]=h[0],e.data[i+1]=h[1],e.data[i+2]=h[2],e.data[i+3]=h[3]),i+=4}return e},a.prototype.CleanBorderPixels=function(){for(let t=0;t<this.width;t++)this.data[t]=0,this.data[(this.height-1)*this.width+t]=0;for(let t=1;t<this.height-2;t++)this.data[t*this.width]=0,this.data[t*this.width+(this.width-1)]=0},a.prototype.thin=function(){let t=this.width-2;for(let i=1;i<this.height-1;i++){t+=2;for(let i=1;i<this.width-1;i++){if(t++,0==(1&this.data[t]))continue;const i=this.getCurrentNeighborhood(t);(0==(7&i)&&112==(112&i)||0==(14&i)&&160==(160&i)||0==(28&i)&&193==(193&i)||0==(56&i)&&130==(130&i)||0==(112&i)&&7==(7&i)||0==(224&i)&&10==(10&i)||0==(193&i)&&28==(28&i)||0==(131&i)&&40==(40&i))&&(this.data[t]=0)}}return this.data},a.prototype.skeletonizeEckhardtMaderlechner93=function(t,i,e){const h=this.width*this.height,o=new Array(this.width*this.height),n=new Array(this.width*this.height),s=new Array(this.width*this.height),r=new Array(this.width*this.height),a=new Array(this.width*this.height),g=new Array(this.width*this.height),d=new Array(this.width*this.height),f=new Array(this.width*this.height);let u=!0,y=0;const l=this.width+1,c=h-this.width-1;for(;u&&y<t;){u=!1;for(let t=l;t<c;t++)n[t]=this.getNbStrongNeighbors(this.data,t),s[t]=n[t]+this.getNbNoStrongNeighbors(this.data,t),this.data[t]?4==n[t]?(o[t]=2,f[t]=1):(o[t]=1,f[t]=2):o[t]=0;for(let t=l;t<c;t++)this.data[t]?r[t]=1==o[t]&&(2==o[t+1]||2==o[t-1]||2==o[t+this.width]||2==o[t-this.width]):r[t]=!1,r[t]?(r[t]=1,f[t]=3):r[t]=0;for(let t=l;t<c;++t){if(this.data[t]&&1==o[t]){let i=0!=(1&this.data[t+1]),e=0!=(1&this.data[t-this.width+1]),h=0!=(1&this.data[t-this.width]),n=0!=(1&this.data[t-this.width-1]),s=0!=(1&this.data[t-1]),r=0!=(1&this.data[t+this.width-1]),a=0!=(1&this.data[t+this.width]),d=0!=(1&this.data[t+this.width+1]);const f=(1-i)*e+(1-e)*h+(1-h)*n+(1-n)*s+(1-s)*r+(1-r)*a+(1-a)*d+(1-d)*i,u=i+e+h+n+s+r+a+d,y=1==f||0==f&&8==u;g[t]=1==o[t]&&y&&(i||h||s||a)}else g[t]=!1;g[t]&&(f[t]=4)}for(let t=l;t<c;++t){if(this.data[t]){const i=2==o[t+1]&&!this.data[t-1],e=2==o[t-1]&&!this.data[t+1],h=2==o[t+this.width]&&!this.data[t-this.width],n=2==o[t-this.width]&&!this.data[t+this.width];a[t]=r[t]&&(i||e||h||n)}else a[t]=!1;a[t]&&(f[t]=5)}for(let t=0;t<h;++t)this.data[t]?g[t]&&a[t]?(d[t]=0,f[t]=6,u=!0):0==s[t]?d[t]=0:i.data[t]<e&&1==s[t]?(d[t]=0,u=!0):d[t]=1:(d[t]=0,f[t]=0);for(let t=0;t<d.length;t++)this.data[t]=d[t];++y}},a.prototype.getCurrentNeighborhood=function(t){var i=this.data;return(1&i[t-1])<<7|(1&i[t+1])<<3|(1&i[t+this.width])<<5|(1&i[t-this.width])<<1|1&i[t-(this.width+1)]|(1&i[t-(this.width-1)])<<2|(1&i[t+(this.width-1)])<<6|(1&i[t+(this.width+1)])<<4},a.prototype.nbNeighbours=function(t){return(1&t)+(t>>1&1)+(t>>2&1)+(t>>3&1)+(t>>4&1)+(t>>5&1)+(t>>6&1)+(t>>7&1)},a.prototype.getNbStrongNeighbors=function(t,i){return t[i-1]+t[i+1]+t[i-this.width]+t[i+this.width]},a.prototype.getNbNoStrongNeighbors=function(t,i){return t[i-1-this.width]+t[i-1+this.width]+t[i+1-this.width]+t[i+1+this.width]},a.prototype.isInnerBoundaryPixel=function(t,i){return 1==t[i]&&2==t[i-1]||2==t[i+1]||2==t[i-this.width]||2==t[i+this.width]},a.prototype.isSimpleBoundaryPixel=function(t,i){let e=0!=(1&t[i+1]),h=0!=(1&t[i-this.width+1]),o=0!=(1&t[i-this.width]),n=0!=(1&t[i-this.width-1]),s=0!=(1&t[i-1]),r=0!=(1&t[i+this.width-1]),a=0!=(1&t[i+this.width]),g=0!=(1&t[i+this.width+1]);const d=(1-e)*h+(1-h)*o+(1-o)*n+(1-n)*s+(1-s)*r+(1-r)*a+(1-a)*g+(1-g)*e;return(1==d||0==d&&8==e+h+o+n+s+r+a+g)&&(e||o||s||a)};var g=a,d=function(t,i){this.position=t,this.weight=i,this.neighbors=new Map};d.computeKey=function(t,i){return Math.floor(t)+";"+Math.floor(i)},d.getXYFromKey=function(t){var i=t.split(";");return i[0]=parseInt(i[0]),i[1]=parseInt(i[1]),i},d.prototype.constructor=d,d.prototype.getKey=function(){return d.computeKey(this.position.x,this.position.y)},d.prototype.getPosition=function(){return this.position},d.prototype.getWeight=function(){return this.weight},d.prototype.getNeighbors=function(){return this.neighbors},d.prototype.setPosition=function(t){this.position=t},d.prototype.setWeight=function(t){this.weight=t},d.prototype.setNeighbors=function(t){this.neighbors=t},d.prototype.addNeighbor=function(t){this.neighbors.set(t.getKey(),t),t.neighbors.set(this.getKey(),this)},d.prototype.removeNeighbor=function(t){this.neighbors.delete(t.getKey()),t.neighbors.delete(this.getKey())},d.prototype.hasNeighbor=function(t){return this.neighbors.has(t.getKey())};var f=d,u=function(t,i){this.x=t||0,this.y=i||0};u.prototype.length=function(t){var i=this.x,e=this.y;return Math.sqrt(i*i+e*e)},u.prototype.subPoints=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},u.prototype.angle=function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t};var y=u;const l=f,c=r,p=y;var w=function(t,i){this.skelImg=t,this.distImg=i};w.prototype.constructor=w,w.prototype.buildHierarchy=function(t){(t=t||{}).angle=t.angle||Math.PI/13,t.weightFactor=t.weightFactor||1.25;const i=this.skelImg.width*this.skelImg.height;let e={},h=[],o=this._findNextPixelWithNeighbors(0);for(;o<i;){const t=this.skelImg.getXFromIndex(o),i=this.skelImg.getYFromIndex(o);var n=l.computeKey(t+.5,i+.5);void 0===e[n]&&(e[n]=new l(new c(t+.5,i+.5),this.distImg.data[o]/this.distImg.getCoeff()),h.push(e[n]),this._recHierarchy(e[n],e)),o=this._findNextPixelWithNeighbors(o+1)}return this._simplifyHierarchy(h,t.angle,t.weightFactor)},w.prototype._simplifyHierarchy=function(t,i,e){if(e<1)throw"weight_factor must be greater than 1 as it compares weight_max and weight_factor*weight_min";for(var h=function(t,o){for(var n=new p,s=o,a=new p,g=s.getNeighbors().size,d=!0,f=!0,u=null,y=0;2===g&&d&&f&&!r[s.getKey()];){var l=s.getNeighbors().keys();u=s,(s=s.getNeighbors().get(l.next().value))===t&&(s=u.getNeighbors().get(l.next().value));y<3&&(a.x+=s.getPosition().x,a.y+=s.getPosition().y),2===y&&(a.x=(a.x-3*t.getPosition().x)/3,a.y=(a.y-3*t.getPosition().y)/3),y++,n.subPoints(s.getPosition(),t.getPosition());var c=n.angle()-a.angle();if(Math.abs(c)<i||y<3||(d=!1),y>=3){var w=t.getWeight()/s.getWeight();w<1&&(w=1/w),w>e&&(f=!1)}d&&f&&(t.removeNeighbor(u),s.removeNeighbor(u),t.addNeighbor(s)),r[u.getKey()]=!0,g=s.getNeighbors().size}if(!r[s.getKey()])if(1===g)d&&f||u&&u.removeNeighbor(s),0===y&&t.removeNeighbor(s),r[s.getKey()]=!0;else if(2===g)h(u,s),r[u.getKey()]=!0;else{var x=[];s.getNeighbors().forEach((function(i,e,h){i!==u&&i!==t&&x.push(i)})),u&&(t.removeNeighbor(u),s.removeNeighbor(u),t.addNeighbor(s)),r[s.getKey()]=!0;for(var I=new Map,m=0;m<x.length;++m){for(var v=m+1;v<x.length;++v)x[m].removeNeighbor(x[v]);x[m].getNeighbors().forEach((function(t,i,e){I.set(i,t)}))}I.delete(s.getKey());var b=new p;I.forEach((function(t,i,e){for(var h=0,o=0;o<x.length;++o)t.hasNeighbor(x[o])&&h++;if(h>1)for(o=0;o<x.length;++o)t.hasNeighbor(x[o])&&(b.subPoints(t.getPosition(),x[o].getPosition()),b.length()>1&&t.removeNeighbor(x[o]))}));for(m=0;m<x.length;++m)h(s,x[m])}},o=0;o<t.length;++o){var n=t[o],s=null;n.getNeighbors().size>1&&(s=new l(new c(n.getPosition().x,n.getPosition().y-1),n.getWeight()),n.addNeighbor(s),t[o]=s,n=s);var r={};r[n.getKey()]=!0,n.getNeighbors().get(n.getNeighbors().keys().next().value),h(n,n.getNeighbors().get(n.getNeighbors().keys().next().value))}return t},w.prototype._findNextPixelWithNeighbors=function(t){const i=this.skelImg.width*this.skelImg.height;let e=t;for(e=t;e<i;e++)if(1&this.skelImg.data[e]){if(0!=this.skelImg.getCurrentNeighborhood(e))break;this.skelImg.data[e]=0}return e},w.prototype._checkAndCreate=function(t,i,e,h){var o=l.computeKey(t+.5,i+.5),n=!1;return void 0===h[o]&&(h[o]=new l(new c(t+.5,i+.5),this.distImg.getValue(t,i)/this.distImg.getCoeff()),n=!0),e.neighbors.set(o,h[o]),n},w.prototype._addNeighbors=function(t,i,e){this.skelImg.width;const h=Math.floor(t.position.x),o=Math.floor(t.position.y);let n=0;return 1&i&&(n+=this._checkAndCreate(h-1,o-1,t,e)?1:0),2&i&&(n+=this._checkAndCreate(h,o-1,t,e)?1:0),4&i&&(n+=this._checkAndCreate(h+1,o-1,t,e)?1:0),8&i&&(n+=this._checkAndCreate(h+1,o,t,e)?1:0),16&i&&(n+=this._checkAndCreate(h+1,o+1,t,e)?1:0),32&i&&(n+=this._checkAndCreate(h,o+1,t,e)?1:0),64&i&&(n+=this._checkAndCreate(h-1,o+1,t,e)?1:0),128&i&&(n+=this._checkAndCreate(h-1,o,t,e)?1:0),n},w.prototype._addNeighborsOLD=function(t,i,e,h){const o=this.skelImg.width,n=e%o,s=Math.round(e/o);let r=0;if(1&i){if(void 0===h[e-o-1]){const t=new l(new c(n-1+.5,s-1+.5),this.distImg.getIndexValue(e-o-1));h[e-o-1]=t,r++}t.neighbors.set(e-o-1,h[e-o-1])}if(2&i){if(void 0===h[e-o]){const t=new l(new c(n+.5,s-1+.5),this.distImg.getIndexValue(e-o));h[e-o]=t,r++}t.neighbors.set(e-o,h[e-o])}if(4&i){if(void 0===h[e-o+1]){const t=new l(new c(n+1+.5,s-1+.5),this.distImg.getIndexValue(e-o+1));h[e-o+1]=t,r++}t.neighbors.set(e-o+1,h[e-o+1])}if(8&i){if(void 0===h[e+1]){const t=new l(new c(n+1+.5,s+.5),this.distImg.getIndexValue(e+1));h[e+1]=t,r++}t.neighbors.set(e+1,h[e+1])}if(16&i){if(void 0===h[e+o+1]){const t=new l(new c(n+1+.5,s+1+.5),this.distImg.getIndexValue(e+o+1));h[e+o+1]=t,r++}t.neighbors.set(e+o+1,h[e+o+1])}if(32&i){if(void 0===h[e+o]){const t=new l(new c(n+.5,s+1+.5),this.distImg.getIndexValue(e+o));h[e+o]=t,r++}t.neighbors.set(e+o,h[e+o])}if(64&i){if(void 0===h[e+o-1]){const t=new l(new c(n-1+.5,s+1+.5),this.distImg.getIndexValue(e+o-1));h[e+o-1]=t,r++}t.neighbors.set(e+o-1,h[e+o-1])}if(128&i){if(void 0===h[e-1]){const t=new l(new c(n-1+.5,s+.5),this.distImg.getIndexValue(e-1));h[e-1]=t,r++}t.neighbors.set(e-1,h[e-1])}return r},w.prototype._recHierarchy=function(t,i){const e=this.skelImg.getCurrentNeighborhood(this.skelImg.getIndex(Math.floor(t.position.x),Math.floor(t.position.y)));if(this._addNeighbors(t,e,i))for(let[e,h]of t.getNeighbors())this._recHierarchy(h,i)};var x=w;const I=y,m=r;var v,b,N,M=(v=new I,b=new I,N=new m,function(t,i,e,h,o){v.x=i.x-t.x,v.y=i.y-t.y;var n=v.length();v.x=v.x/n,v.y=v.y/n,b.subPoints(o,t);var s=b.length(),r=s*s,a=b.x*v.x+b.y*v.y,g=(a+-Math.sqrt(Math.max(0,r-a*a))/n*(e-h))/n;return g>1&&(g=1),g<0&&(g=0),N.x=t.x,N.y=t.y,N.x+=(i.x-N.x)*g,N.y+=(i.y-N.y)*g,N.z+=(i.z-N.z)*g,b.x=o.x-N.x,b.y=o.y-N.y,b.length()-(g*h+(1-g)*e)});const k=f,P=r,_=M;var C=function(t){this.distImg=t};C.prototype.constructor=C,C.prototype.buildHierarchy=function(){var t=this;const i=this.distImg.width,e=this.distImg.height;for(var h={},o={},n=[],s=new Array(i*e),r=0;r<s.length;++r)s[r]=!1;for(var a=function(e,h,o){for(var n=e.position.x,r=e.position.y,a=e.getPosition(),g=Math.ceil(e.weight),d=h?Math.ceil(h.getWeight()):0,f=h?h.getPosition():null,u=new P(0,0),y={min:{x:h?Math.min(a.x-g,f.x-d):a.x-g,y:h?Math.min(a.y-g,f.y-d):a.y-g},max:{x:h?Math.max(a.x+g,f.x+d):a.x+g,y:h?Math.max(a.y+g,f.y+d):a.y+g}},l=y.min.x;l<y.max.x;l++)for(var c=y.min.y;c<y.max.y;c++){u.x=l,u.y=c;var p=h?_(e.getPosition(),h.getPosition(),g,Math.ceil(h.weight),u):(l-n)*(l-n)+(c-r)*(c-r);if(h?p<=0:p<=g*g)s[v=c*i+l]=!0,delete o[v]}for(var w=2*Math.PI*(e.weight+1),x=Math.round(w),I=0;I<x;++I){var m=2*I*Math.PI/x,v=(l=Math.round(e.position.x+Math.cos(m)*(e.weight+1)),(c=Math.round(e.position.y+Math.sin(m)*(e.weight+1)))*i+l),b=t.distImg.getValue(l,c)/t.distImg.getCoeff();!s[v]&&b>3&&(o[v]=e)}},g=0,d=-1,f=-1,u=0;u<i;++u)for(var y=0;y<e;++y){var l=this.distImg.getValue(u,y);l>g&&(g=l,d=u,f=y)}var c=new k(new P(d,f),g/this.distImg.getCoeff());o[this.distImg.getIndex(d,f)]=c,n.push(c),a(c,null,h);for(var p=0,w=Object.keys(h);0!==w.length&&p<1e4;){var x=-1,I=0;for(r=0;r<w.length;++r){var m=parseInt(w[r]);s[m]?delete h[w[r]]:this.distImg.getIndexValue(m)>I&&(I=this.distImg.getIndexValue(m),x=m)}I/=this.distImg.getCoeff();var v=new P(this.distImg.getXFromIndex(x),this.distImg.getYFromIndex(x)),b=h[x],N={v:I,p:new P(v.x,v.y),idx:x};(function(){var i=b.getPosition().distanceTo(v),e=new P(0,0);e.barycenter(v,b.getPosition(),.5,.5),e.x=Math.round(e.x),e.y=Math.round(e.y);var h=t.distImg.getValue(e.x,e.y)/t.distImg.getCoeff(),o=new P(0,0),n=new P(v.x-b.getPosition().x,v.y-b.getPosition().y);n.x/=i,n.y/=i;for(var s=new P(-n.y,n.x),r={v:h,p:new P(e.x,e.y),idx:x},a=Math.max(b.getWeight()/2,3),g=-a;g<=a;g++){o.x=Math.round(e.x+g*s.x),o.y=Math.round(e.y+g*s.y);var d=t.distImg.getValue(o.x,o.y)/t.distImg.getCoeff();d>r.v&&d>h+1.5&&(r.v=d,r.p.x=o.x,r.p.y=o.y)}return(r.p.x!==e.x||r.p.y!==e.y)&&(N.v=r.v,N.p.x=r.p.x,N.p.y=r.p.y,N.idx=t.distImg.getIndex(r.p.x,r.p.y),!0)})()||function(){for(var i=b.getPosition().distanceTo(v),e=new P(0,0),h=1;h<i;h+=1){var o=h/i;e.barycenter(v,b.getPosition(),1-o,o),e.x=Math.round(e.x),e.y=Math.round(e.y);var n=t.distImg.getValue(e.x,e.y)/t.distImg.getCoeff(),s=h+I-n,r=(1-o)*I+o*b.weight;s<1&&n>r&&(N.v=n,N.p.x=e.x,N.p.y=e.y,N.idx=t.distImg.getIndex(e.x,e.y))}}();var M=new k(N.p,N.v);M.neighbors.set(this.distImg.getIndex(b.position.x,b.position.y),b),b.neighbors.set(this.distImg.getIndex(M.position.x,M.position.y),M),o[N.idx]=M,n.push(M),delete h[x],delete h[N.idx],a(M,b,h),w=Object.keys(h),p++}return n};var A=C;return t.CapsuleDistance=M,t.Point2D=r,t.QuiblierSkeletonizer=A,t.SkeletonImage=g,t.Skeletonizer=x,t.drawHierarchyInImageData=function(t,i,e){for(var h=i,o="capsule"===e,n=new r,s={},a=[],g=[],d=function(t){var i=t.getKey();void 0===s[i]&&(s[i]=t,a.push(t),t.getNeighbors().forEach((function(i,e,h){var o=i.getKey();void 0===s[o]&&g.push([t,i]),d(i)})))},f=0;f<t.length;++f)d(t[f]);for(var u=0;u<h.width;++u)for(var y=0;y<h.height;++y){var l=0;if(n.x=u+.5,n.y=y+.5,o)for(f=0;f<g.length;++f){var c=g[f][0],p=g[f][1];M(c.getPosition(),p.getPosition(),c.getWeight(),p.getWeight(),n)<=0&&l++}else for(f=0;f<a.length;++f){var w=Math.floor(a[f].getPosition().x)+.5,x=Math.floor(a[f].getPosition().y)+.5;(n.x-w)*(n.x-w)+(n.y-x)*(n.y-x)<=a[f].getWeight()*a[f].getWeight()&&l++}var I=4*(y*h.width+u);h.data[I+1]=(h.data[I+1]+255*l)/(l+1)}for(f=0;f<a.length;++f){var m=a[f];I=4*(Math.floor(m.position.y)*h.width+Math.floor(m.position.x));h.data[I]=255,h.data[I+1]=0,h.data[I+2]=0}return h},t.drawSkeletonInCanvas=function(t,i){for(var e=i.getContext("2d"),h={},o=[],n=function(t){var i=t.position.x+";"+t.position.y;void 0===h[i]&&(h[i]=t,o.push(t),t.getNeighbors().forEach((function(t,i,e){n(t)})))},s=0;s<t.length;++s)n(t[s]);for(s=0;s<o.length;++s){var r=o[s];r.getNeighbors().forEach((function(t,i,h){e.lineWidth=1,e.strokeStyle="#ff0000",e.beginPath(),e.moveTo(r.position.x,r.position.y),e.lineTo(t.position.x,t.position.y),e.stroke(),e.fillStyle="#0000ff",e.fillRect(r.position.x,r.position.y,1,1),e.fillRect(t.position.x,t.position.y,1,1)}))}},t.skeletonize=function(t,i,h){var o=new e(t),s=new n(3,4,o,0),r=new g(o,0,2e3,s);return{skeleton:new x(r,s).buildHierarchy({angle:i||void 0,weightFactor:h||void 0}),binaryImg:o,distImg:s,skelImg:r}},t.skeletonizeQ=function(t){var i=new e(t),h=new n(3,4,i,0);return{skeleton:new A(h).buildHierarchy(),binaryImg:i,distImg:h}},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
